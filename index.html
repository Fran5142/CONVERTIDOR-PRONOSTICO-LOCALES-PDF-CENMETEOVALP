<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<style>
/* Configuraci칩n general de la web */
body { font-family: Arial, sans-serif; margin: 0; padding: 20px; background: #001f3f; color: #fff; }

.controles {
  text-align: center;
  background: rgba(255, 255, 255, 0.1);
  padding: 25px;
  border-radius: 15px;
  width: 85%;
  margin: 0 auto 20px auto;
  box-shadow: 0 4px 15px rgba(0,0,0,0.3);
  border: 1px solid rgba(255, 255, 255, 0.1);
}

.titulo-web {
  font-size: 24px;
  font-weight: bold;
  margin-bottom: 20px;
  color: #00b4d8;
  text-transform: uppercase;
  letter-spacing: 1px;
}

#nombreArchivo {
  padding: 12px;
  width: 450px;
  border-radius: 8px;
  border: 2px solid #00b4d8;
  margin-bottom: 15px;
  font-size: 14px;
  background: #f8f9fa;
  color: #333;
  text-align: center;
  font-weight: bold;
}

/* SECCI칍N DE BOTONES DE EJEMPLO */
.ejemplos-contenedor {
  margin-bottom: 20px;
  font-size: 14px;
}
.ejemplos-label { font-weight: bold; color: #fff; display: block; margin-bottom: 10px; }

.boton-ejemplo { 
  background: rgba(0, 180, 216, 0.2); 
  padding: 8px 15px; 
  border-radius: 6px; 
  border: 1px solid #00b4d8;
  color: #90e0ef;
  margin: 5px;
  cursor: pointer;
  display: inline-block;
  font-size: 12px;
  transition: 0.2s;
}
.boton-ejemplo:hover {
  background: #00b4d8;
  color: #001f3f;
}

#textoInforme {
  width: 100%; height: 180px; margin-bottom: 20px; padding: 12px;
  font-family: Arial, sans-serif; font-size: 14px; border-radius: 10px; display: block;
  box-sizing: border-box; border: 1px solid #ccc;
}

.btn-accion { margin: 10px 5px; padding: 12px 25px; font-weight: bold; border-radius: 8px; cursor: pointer; background: #00b4d8; color: #001f3f; border: none; transition: 0.3s; }
.btn-accion:hover { background: #90e0ef; transform: translateY(-2px); }

.autor-web {
  font-size: 18px;
  color: #ffffff;
  margin-top: 25px;
  font-weight: bold;
  font-style: italic;
  text-shadow: 2px 2px 4px rgba(0,0,0,0.5);
  display: block;
  opacity: 0.9;
}

/* --- FORMATO HOJA CARTA PDF (AJUSTADO A 11pt) --- */
#vistaPrevia {
  width: 215.9mm; 
  min-height: 279.4mm; 
  background: #fff; 
  color: #000;
  margin: 30px auto; 
  padding: 10mm 20mm; 
  font-family: Arial, sans-serif; 
  font-size: 11pt; /* CAMBIO A TAMA칌O 11 */
  line-height: 1.2;
  position: relative; 
  box-sizing: border-box;
  display: flex;
  flex-direction: column;
  box-shadow: 0 0 20px rgba(0,0,0,0.5);
}

.header-container { display: flex; justify-content: space-between; align-items: center; margin-bottom: 25px; }
.header-text { text-align: center; font-size: 10pt; line-height: 1.3; }
.armada-bold { font-weight: bold; display: block; }
.header-normal { font-weight: normal; display: block; }
.logo-anchor { width: 80px; text-align: right; }
.logo-estilizado { height: 100px; width: auto; transform: scaleX(0.70); transform-origin: right; display: inline-block; }

.titulo-principal {
  text-align: center;
  font-weight: bold;
  text-decoration: underline;
  display: block;
  text-transform: uppercase;
  line-height: 1.1;
  margin-bottom: 5px;
  font-size: 11pt;
}

.negrita { font-weight: bold; }
.seccion-titulo { font-weight: bold; display: block; margin-top: 0px; }
.contenido-texto { display: block; margin-bottom: 5px; text-align: justify; }

.contenedor-temp {
  display: grid;
  grid-template-columns: 290px 10px auto; 
  font-weight: bold;
  line-height: 1.3;
  font-size: 11pt; /* TEMPERATURAS A TAMA칌O 11 */
}

.espacio-arriba { margin-top: 15px; display: block; }

.footer-informe {
  margin-top: auto; 
  text-align: right;
  font-size: 8.5pt;
  padding-top: 20px;
}
.footer-bold { font-weight: bold; }
.footer-normal { font-weight: normal; }
.footer-link { color: #0000FF; text-decoration: underline; }
</style>
</head>

<body>

<div class="controles">
  <div class="titulo-web">
    Creador de Informes meteorol칩gicos En PDF<br>
    Valpara칤so - Quintero - San Antonio - Coquimbo
  </div>
  
  <input type="text" id="nombreArchivo" placeholder="Seleccione un ejemplo o escriba el nombre aqu칤">
  
  <div class="ejemplos-contenedor">
    <span class="ejemplos-label">Seleccione Bah칤a para el nombre del archivo:</span>
    <div class="boton-ejemplo" onclick="setNombre('INFORME BAH칈A DE VALPARA칈SO')">VALPARA칈SO</div>
    <div class="boton-ejemplo" onclick="setNombre('INFORME BAH칈A DE QUINTERO')">QUINTERO</div>
    <div class="boton-ejemplo" onclick="setNombre('INFORME BAH칈A DE SAN ANTONIO')">SAN ANTONIO</div>
    <div class="boton-ejemplo" onclick="setNombre('INFORME BAH칈A DE COQUIMBO')">COQUIMBO</div>
  </div>

  <textarea id="textoInforme" placeholder="Pegue aqu칤 el contenido del informe meteorol칩gico..."></textarea>
  
  <div>
    <button class="btn-accion" onclick="generarVista()">游댌 Ver vista previa</button>
    <button class="btn-accion" onclick="generarPDF()" style="background:#e63946; color:white;">游늯 Generar PDF</button>
  </div>

  <div class="autor-web">
    Creado por Cabo 1췈 (Met.) Francisco Salas Mu침oz
  </div>
</div>

<div id="vistaPrevia"></div>

<script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>

<script>
// Funci칩n para escribir el nombre autom치ticamente al hacer clic
function setNombre(nombre) {
    document.getElementById('nombreArchivo').value = nombre;
}

function normalizarTextoBase(texto) {
    return texto.toUpperCase()
        .normalize("NFD")
        .replace(/[\u0300-\u036f]/g, function(match) {
            return match === '\u0303' ? match : ''; 
        })
        .normalize("NFC");
}

function generarVista() {
    let texto = document.getElementById("textoInforme").value.trim();
    if (!texto) return;
    
    texto = normalizarTextoBase(texto);
    let lineas = texto.split("\n").map(l => l.trim()).filter(l => l !== "");
    
    const urlLogo = "https://archive.org/download/logo_dorado_40kb/logo_dorado_40kb.png";

    let htmlContent = `
    <div class="header-container">
      <div class="header-text">
        <span class="armada-bold">Armada de Chile</span>
        <span class="header-normal">Comandancia en Jefe la I. Zona Naval</span>
        <span class="header-normal">Gobernaci칩n Mar칤tima de Valpara칤so</span>
        <span class="header-normal">Centro Meteorol칩gico Mar칤timo V.</span>
      </div>
      <div class="logo-anchor">
         <img src="${urlLogo}" class="logo-estilizado">
      </div>
    </div>
    `;

    lineas.forEach((linea, index) => {
        if (index < 2) {
            htmlContent += `<div class="titulo-principal">${linea}</div>`;
            if (index === 1) htmlContent += `<span class="espacio-arriba"></span>`; 
        }
        else if (/^(SABADO|DOMINGO|LUNES|MARTES|MIERCOLES|JUEVES|VIERNES)\s+\d+/i.test(linea)) {
            htmlContent += `<span class="espacio-arriba"></span><div class="negrita">${linea}</div>`;
        }
        else if (linea.startsWith("SITUACION SINOPTICA:")) {
            htmlContent += `<div class="seccion-titulo">${linea}</div>`;
        }
        else if (linea.startsWith("PRONOSTICO:")) {
            htmlContent += `<span class="espacio-arriba"></span><div class="seccion-titulo">${linea}</div>`;
        }
        else if (linea.includes("TEMPERATURA MINIMA PROBABLE") || 
                 linea.includes("TEMPERATURA MAXIMA PROBABLE") || 
                 linea.includes("INDICE DE RADIACION ULTRAVIOLETA")) {
            
            if (linea.includes("TEMPERATURA MINIMA PROBABLE")) {
                htmlContent += `<span class="espacio-arriba"></span>`;
            }

            let partes = linea.split(':');
            htmlContent += `
                <div class="contenedor-temp">
                    <div>${partes[0].trim()}</div>
                    <div>:</div>
                    <div>${partes[1] ? partes[1].trim() : ""}</div>
                </div>`;
        }
        else if (linea.startsWith("PRONOSTICO VALIDO") || /^MET\w{5}/.test(linea)) {
            htmlContent += `<span class="espacio-arriba"></span><div class="negrita">${linea}</div>`;
        }
        else {
            htmlContent += `<div class="contenido-texto">${linea}</div>`;
        }
    });

    htmlContent += `
    <div class="footer-informe">
      <div class="footer-bold">CENTRO METEOROL칍GICO MAR칈TIMO DE VALPARA칈SO</div>
      <div class="footer-normal">
        <span class="footer-link">http://meteoarmada.directemar.cl</span> // @MetArmada_Valp<br>
        SUBIDA LEOPOLDO CARVALLO 150, PLAYA ANCHA<br>
        TEL: (32) 2208965 - 2208914
      </div>
    </div>
    `;

    document.getElementById("vistaPrevia").innerHTML = htmlContent;
}

async function generarPDF() {
    const { jsPDF } = window.jspdf;
    const element = document.getElementById("vistaPrevia");
    
    let nombrePersonalizado = document.getElementById("nombreArchivo").value.trim();
    if (!nombrePersonalizado) {
        nombrePersonalizado = "Informe_Meteorologico";
    }

    const canvas = await html2canvas(element, { scale: 3, useCORS: true });
    const imgData = canvas.toDataURL("image/jpeg", 1.0);
    const pdf = new jsPDF("p", "mm", "letter");
    pdf.addImage(imgData, "JPEG", 0, 0, 215.9, 279.4);
    
    pdf.save(nombrePersonalizado + ".pdf");
}
</script>
</body>
</html>